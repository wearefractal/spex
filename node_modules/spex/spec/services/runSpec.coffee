vm = require 'vm'

runSpec = (spec) ->

  sandbox = {}

  # namespacing for the spec DSL
  sandbox.spex = spec

  # spex.* would give you access to the related Spec object from within the spec DSL
  # we use it to call Spec's "pass" method based on a scenario's outcome

  try
    # run testCode in a new js vm
    # the sandbox is modified within the vm
    vm.runInNewContext spec.testCode, sandbox
    spec.status = 'pass'
  catch err
    spec.status = 'fail'
    spec.fail err.scenarioId


module.exports = runSpec


### TEST

should = require 'should'
Spec = require('spex').load 'spec.models.Spec'

#>> Given some valid code in a Spec

code = ">> Given some spec code\nfoo = 'foo'"
mySpec = new Spec 'myspec', code, true
mySpec.status.should.equal 'notrun'

#>> when I run the spec

runSpec mySpec

#>> Then

mySpec.status.should.equal 'pass'

