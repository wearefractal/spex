async = require 'async'
log = require 'node-log'
util = require 'util'; dump = (obj) -> log.info util.inspect(obj)
spec = {}
spec.buildScenarios = require('spex').load 'spec.services.buildScenarios'
spec.buildTest = require('spex').load 'spec.services.buildTest'

# a **Spec** is a specification describing some important feature of your system
# a Spec consists of **Scenarios** - blocks of code that do

class Spec
  status: 'notrun'

  constructor: (@name, specDSL, @isCoffee, done) ->

    @scenarios = spec.buildScenarios specDSL
    @testCode = spec.buildTest @scenarios, @isCoffee

  pass: (id) -> @scenarios[id].pass(); console.log "called pass #{id}"
  fail: (id, err) -> @scenarios[id].fail err; console.log "called fail #{id}"

module.exports = Spec

### TEST #functional

should = require 'should'

#>> Given some spec code

code = ">> Given some spec code\nfoo = 'foo'"

#>> When you create a new Spec

mySpec = new Spec 'myspec', code, true
mySpec.should.be.an.instanceof Spec
mySpec.scenarios.length.should.equal 1

