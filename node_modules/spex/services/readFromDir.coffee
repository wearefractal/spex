fs = require 'fs'
path = require 'path'
util = require 'util'; dump = (obj) -> log.info util.inspect(obj)
#async = require 'async'
Spec = require ("../../spec/controller").models.newSpec()

readFromDir = (specDir) ->

  try
    dir = path.join process.cwd(), specDir # TODO: Allow configuration for the spec dir
    files = fs.readdirSync dir
    # TODO: add sync support
    # async.mapSeries files, runTest, (err, results) ->
    specs = files.map (file) ->
      ext = path.extname file
      name = path.basename file, ext
      spec = (fs.readFileSync "#{ dir }/#{ file }").toString()
      isCoffee = ext is '.coffee'
      log.info "#{ name }, #{ spec }, #{ isCoffee }"
      return new Spec name, spec, isCoffee
  catch err
    log.error err

module.exports = readFromDir

## TEST

#>> Given a directory with some Specs in it

dir = path.join __dirname, "../../../specs/"

#>> When I pass the dir path to *readFromDir*
#>> Then it should return a list of Specs

specs = readFromDir dir

#>> And

specs.length.should.equal 2
spec.should.be.an.instanceof Spec for spec in specs

