log = require 'node-log'
fs = require 'fs'
path = require 'path'
Spec = require('spex').load "spec.models.Spec"
runSpec = require('spex').load "spec.services.runSpec"

readFromDir = (specDir) ->

  #dir = path.join process.cwd(), specDir # TODO: Allow configuration for the spec dir
  files = fs.readdirSync specDir
  specs = files.map (file) ->
    ext = path.extname file
    name = path.basename file, ext
    spec = (fs.readFileSync "#{ specDir }/#{ file }").toString()
    isCoffee = ext is '.coffee'
    newSpec = new Spec name, spec, isCoffee
    newSpec = runSpec newSpec
    return newSpec

module.exports = readFromDir

### TEST

should = require 'should'

#>> Given a directory with some Specs in it

dir = "./specs/"

#>> When I pass the dir path to *readFromDir*
#>> Then it should return a list of Specs

specs = readFromDir dir
#>> And

specs.length.should.equal 2
spec.should.be.an.instanceof Spec for spec in specs
spec.status.should.equal 'pass'

